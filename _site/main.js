!function(){"use strict";const e=new Tone.MonoSynth({oscillator:{type:"square"},envelope:{attack:.1}}).toDestination(),t=["C4","E4","G4","A4"],s=[0,.5,1,1.5],i=t=>{const i=Tone.now();s.forEach(((s,o)=>{e.triggerAttackRelease(t[o],"8n",i+s)}))},o=e=>{const{value:t,id:s,type:i,name:o}=e.target;"text"!==i?localStorage.setItem(o,t):localStorage.setItem(s,t)},n=e=>localStorage.getItem(e);class a{constructor(e,t={}){this.options=Object.assign({closeClickOutside:!1,forceStateClose:!1,forceStateOpen:!1,closeEsc:!1,forceStateRestore:!0},t),this.detail=e,this.summary=e.querySelector(":scope > summary"),this._previousStates={}}getMatchMedia(e,t){if(e)return t&&!0===t?{matches:!0}:t&&"matchMedia"in window?window.matchMedia(t):void 0}init(){let e=this.getMatchMedia(this.detail,this.options.forceStateOpen),t=this.getMatchMedia(this.detail,this.options.forceStateClose);e&&e.matches&&t&&t.matches?this.setState(!this.detail.open):(e&&e.matches&&this.setState(!0),t&&t.matches&&this.setState(!1)),this.addListener(e,"for-open"),this.addListener(t,"for-close")}addListener(e,t){e&&"addListener"in e&&e.addListener((e=>{e.matches?(this._previousStates[t]=this.detail.open,this.detail.open!==("for-open"===t)&&this.setState("for-open"===t)):this.options.forceStateRestore&&void 0!==this._previousStates[t]&&this.detail.open!==this._previousStates[t]&&this.setState(this._previousStates[t])}))}toggle(){let e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});this.summary.dispatchEvent(e)}triggerClickToClose(){this.summary&&this.options.closeClickOutside&&this.toggle()}setState(e){e?this.detail.setAttribute("open","open"):this.detail.removeAttribute("open")}}class r{constructor(e){this.duration={open:200,close:150},this.detail=e,this.summary=this.detail.querySelector(":scope > summary");let t=this.detail.getAttribute("data-du-animate-target");if(t&&(this.content=this.detail.closest(t)),this.content||(this.content=this.summary.nextElementSibling),!this.content)throw new Error("For now <details-utils> requires a child element for animation.");this.summary.addEventListener("click",this.onclick.bind(this))}parseAnimationFrames(e,...t){let s=[];for(let i of t){let t={};t[e]=i,s.push(t)}return s}getKeyframes(e){let t=this.parseAnimationFrames("maxHeight","0px",`${this.getContentHeight()}px`);return e?t:t.filter((()=>!0)).reverse()}getContentHeight(){return this.contentHeight?this.contentHeight:this.detail.open?(this.contentHeight=this.content.offsetHeight,this.contentHeight):void 0}animate(e,t){this.isPending=!0;let s=this.getKeyframes(e);this.animation=this.content.animate(s,{duration:t,easing:"ease-out"}),this.detail.classList.add("details-animating"),this.animation.finished.catch((e=>{})).finally((()=>{this.isPending=!1,this.detail.classList.remove("details-animating")})),e||this.animation.finished.catch((e=>{})).finally((()=>{this.detail.removeAttribute("open")}))}open(){this.contentHeight?this.animate(!0,this.duration.open):requestAnimationFrame((()=>this.animate(!0,this.duration.open)))}close(){this.animate(!1,this.duration.close)}useAnimation(){return"matchMedia"in window&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}onclick(e){!e.target.closest("a[href]")&&this.useAnimation()&&(this.isPending?this.animation&&this.animation.cancel():this.detail.open?(e.preventDefault(),this.close()):this.open())}}class c extends HTMLElement{constructor(){super(),this.attrs={animate:"animate",closeEsc:"close-esc",closeClickOutside:"close-click-outside",forceStateClose:"force-close",forceStateOpen:"force-open",forceStateRestore:"force-restore",toggleDocumentClass:"toggle-document-class",closeClickOutsideButton:"data-du-close-click"},this.options={},this._connect()}getAttributeValue(e){let t=this.getAttribute(e);return void 0===t||""===t||(t||!1)}connectedCallback(){this._connect()}_connect(){this.children.length?this._init():(this._observer=new MutationObserver(this._init.bind(this)),this._observer.observe(this,{childList:!0}))}_init(){if(this.initialized)return;this.initialized=!0,this.options.closeClickOutside=this.getAttributeValue(this.attrs.closeClickOutside),this.options.closeEsc=this.getAttributeValue(this.attrs.closeEsc),this.options.forceStateClose=this.getAttributeValue(this.attrs.forceStateClose),this.options.forceStateOpen=this.getAttributeValue(this.attrs.forceStateOpen),this.options.forceStateRestore=this.getAttributeValue(this.attrs.forceStateRestore);let e=Array.from(this.querySelectorAll(":scope details"));for(let t of e){new a(t,this.options).init(),this.hasAttribute(this.attrs.animate)&&new r(t)}this.bindCloseOnEsc(e),this.bindClickoutToClose(e),this.toggleDocumentClassName=this.getAttribute(this.attrs.toggleDocumentClass),this.toggleDocumentClassName&&this.bindToggleDocumentClass(e)}bindCloseOnEsc(e){this.options.closeEsc&&document.documentElement.addEventListener("keydown",(t=>{if(27===t.keyCode)for(let t of e)if(t.open){let e=new a(t,this.options),s=e.getMatchMedia(t,this.options.closeEsc);(!s||s&&s.matches)&&e.toggle()}}),!1)}isChildOfParent(e,t){for(;e&&e.parentNode;){if(e.parentNode===t)return!0;e=e.parentNode}return!1}onClickoutToClose(e,t){let s=new a(e,this.options),i=s.getMatchMedia(e,this.options.closeClickOutside);i&&!i.matches||!t.target.hasAttribute(this.attrs.closeClickOutsideButton)&&this.isChildOfParent(t.target,e)||!e.open||s.triggerClickToClose(e)}bindClickoutToClose(e){document.documentElement.addEventListener("mousedown",(t=>{for(let s of e)this.onClickoutToClose(s,t)}),!1),this.addEventListener("keypress",(t=>{if(13===t.which||32===t.which)for(let s of e)this.onClickoutToClose(s,t)}),!1)}bindToggleDocumentClass(e){for(let t of e)t.addEventListener("toggle",(e=>{document.documentElement.classList.toggle(this.toggleDocumentClassName,e.target.open)}))}}const l=new Worker("timer.js");"undefined"!=typeof window&&"customElements"in window&&window.customElements.define("details-utils",c);const h=document.querySelector(".timer"),d=h.querySelector("[name='workDuration']"),u=h.querySelector("#workDuration"),m=h.querySelector("[name='breakDuration']"),p=h.querySelector("#breakDuration"),g=document.querySelector(".settings__form"),f={playing:!1,paused:!1,breaking:!0,elapsedSeconds:0};let S=null;const k=()=>{const e=f.breaking?n("workStart")||g.querySelector("input[name='workStart']:checked").value:n("breakStart")||g.querySelector("input[name='breakStart']:checked").value;if("voice"===e){(e=>{speechSynthesis.speak(new SpeechSynthesisUtterance(e))})(f.breaking?n("workVoiceText")||"work":n("breakVoiceText")||"break")}else"ascChime"===e?i(t):"descChime"===e?i([...t].reverse()):"repeatChime"===e&&i(["E4","E4","E4","E4"])},v=async()=>{!f.playing&&!f.paused&&(l.onmessage=function(){(()=>{let e,t;f.elapsedSeconds=f.elapsedSeconds+1,f.breaking?(e=60*m.value,t=p):(e=60*d.value,t=u),f.elapsedSeconds===e?(document.documentElement.classList.toggle("dark"),k(),f.elapsedSeconds=0,t.innerHTML=e,f.breaking=!f.breaking):t.innerHTML=e-f.elapsedSeconds})()},k(),f.breaking=!1,u.innerHTML=60*d.value,p.innerHTML=60*m.value,S=await navigator.wakeLock.request("screen")),f.playing=!0,f.paused=!1,l.postMessage("start"),document.documentElement.classList.add("playing"),document.documentElement.classList.remove("paused")};h.addEventListener("submit",(e=>{e.preventDefault(),f.playing?(document.documentElement.classList.add("paused"),f.paused=!0,f.playing=!1,l.postMessage("pause")):v()})),h.addEventListener("reset",(e=>{e.preventDefault(),f.playing=!1,f.paused=!1,f.elapsedSeconds=0,l.postMessage("stop"),document.documentElement.classList.remove("paused"),document.documentElement.classList.remove("playing"),document.documentElement.classList.remove("dark"),u.innerHTML=60*d.value,p.innerHTML=60*m.value,S.release().then((()=>{S=null}))})),h.addEventListener("change",(e=>{o(e)})),g.addEventListener("change",(e=>{o(e)}));Object.keys(localStorage).forEach((e=>{document.querySelectorAll(`[name="${e}"]`).forEach((t=>{t.matches("[type='radio']")?t.checked=t.value===n(e):t.setAttribute("value",n(e))}))}))}();
